#!/usr/bin/env python

import os
import sys

sys.path.insert(
    0,
    os.path.abspath(
        os.path.join(os.path.dirname(__file__), '..', 'lib', 'benchlib')
    )
)

from opster import command, dispatch
from schema import Schema

@command()
def install(schema_name):
    diy_prefix = os.path.dirname(os.path.dirname(__file__))
    schemas = os.path.join(diy_prefix, 'schemas')

    if sys.path[0] != schemas:
        filename = os.path.join(schemas, schema_name + '.py')
        code = compile(open(filename).read(), filename, 'exec')

        locals = {}
        module = eval(code, globals(), locals)

        schemas = [schema for schema in locals.values() if issubclass(schema, Schema)]
        assert len(schemas) == 1

        env = dict(
            diy_prefix=diy_prefix,
            schema=schema_name,
        )
        schema = schemas[0](env)
        schema._install()


if __name__ == '__main__':
    dispatch()

